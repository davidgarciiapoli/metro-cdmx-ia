<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultado de Ruta - Metro CDMX</title>

    <style>
        /* Paleta de colores original */
        body {
            font-family: 'Inter', Arial, sans-serif;
            background: linear-gradient(60deg, #0a2540 , #1e3a5f );
            color: #fff;
            margin: 0;
            padding: 0;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            background-color: #2e5c8a;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        header h1 {
            margin: 0;
            font-size: 3em;
            color: #a8d8ff  ;
            text-shadow: 2px 2px 4px #0a2540;
        }

        main {
            max-width: 650px;
            margin: 40px auto;
            padding: 30px;
            background-color: #5b9bd5    ;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
            color: #3c0000;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #0a2540;
            text-decoration: none;
            font-weight: bold;
            background-color: #a8d8ff ;
            padding: 8px 15px;
            border-radius: 8px;
            transition: background-color 0.3s;
        }
        .back-link:hover {
            background-color: #2e5c8a ;
        }

        /* Contenedor de la ruta */
        .route-container {
            border: 2px solid #0a2540 ;
            border-radius: 10px;
            padding: 20px;
            background-color: #d3d3d3  ;
        }

        .route-stop {
            display: flex;
            align-items: center;
            padding: 8px 0;
            font-weight: bold;
        }

        .stop-name { font-size: 1.1em; }

        .stop-line {
            background-color: #2e5c8a;
            color: white;
            padding: 2px 8px;
            border-radius: 15px;
            margin-left: 10px;
            font-size: 0.8em;
        }

        /* Inicio, fin y transbordo */
        .start-stop .stop-name,
        .end-stop .stop-name,
        .transfer-stop .stop-name {
            font-size: 1.3em;
            color: #0a2540 ;
        }

        .intermediate-stop .stop-name {
            font-size: 0.9em;
            font-weight: normal;
            color: #0a2540 ;
        }

        /* Iconos de accesibilidad */
        .accessibility-icons {
            margin-left: 15px;
            display: flex;
            gap: 8px;
        }
        .access-icon {
            font-size: 1.2em;
            color: #2e5c8a;

            cursor: help;
        }

        /* Líneas de conexión */
        .route-line {
            display: flex;
            align-items: center;
            margin-left: 20px;
            height: 15px;
        }
        .route-line .vertical-line {
            width: 3px;
            height: 100%;
            background-color: #3c0000;
            margin-right: 17px;
        }

        .route-bullet {
            width: 10px;
            height: 10px;
            background-color: #3c0000;
            border-radius: 50%;
            margin-right: 10px;
        }

        footer {
            text-align: center;
            padding: 20px;
            background-color: #1e3a5f ;
            margin-top: 40px;
        }

        footer p {
            margin: 0;
            color: #a8d8ff ;
        }
    </style>
</head>

<body>

<header>
    <h1>Resultado de Ruta Óptima</h1>
</header>

<main>
<a href="/" class="back-link">← Nueva Búsqueda</a>

{% if ruta_display %}
    <div class="route-info">
        <h2>Ruta de {{ origen }} a {{ destino }}</h2>
        <p><strong>Fecha/Hora de Salida:</strong> {{ fecha_busqueda }} a las {{ hora_busqueda }}</p>
        <p><strong>Llegada Estimada:</strong> {{ llegada }}</p>
        <p><strong>Duración Total:</strong> {{ tiempo_total }} minutos</p>
    </div>

    <div class="route-container">
    {% for stop in ruta_display %}
        {% set is_major = stop.type == 'start' or stop.type == 'transfer' or stop.type == 'end' %}

        {% if not loop.first %}
        <div class="route-line">
            <div class="vertical-line"></div>
        </div>
        {% endif %}

        <div class="route-stop {{ stop.type }}-stop">
            <div class="route-bullet"></div>
            <span class="stop-name">{{ stop.name }}</span>



            {% if is_major %}
            <span class="stop-line">Línea {{ stop.line }}</span>
            {% endif %}

            {% if stop.type == 'transfer' %}
            <span class="stop-line" style="background-color: #ff8478; color:#3c0000; border:1px solid #3c0000; margin-left:15px;">TRANSBORDO</span>
            {% endif %}

            {% if stop.accesibilidad %}
            <div class="accessibility-icons">
                {% if stop.accesibilidad.escalera == 1 %}
                <span class="access-icon" title="Escaleras">&#x2195;</span>
                {% endif %}
                {% if stop.accesibilidad.mecanica == 1 %}
                <span class="access-icon" title="Escaleras Mecánicas">&#x2699;</span>
                {% endif %}
                {% if stop.accesibilidad.ascensor == 1 %}
                <span class="access-icon" title="Ascensor">&#x267f;</span>
                {% endif %}
            </div>
            {% endif %}
        </div>
    {% endfor %}
    </div>

    <h2 style="color:#0a2540; margin-top:30px;">Mapa del Recorrido</h2>
    <div id="map" style="height: 450px; border-radius: 15px;"></div>

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        const ruta = {{ ruta_coords | tojson }};
        if (ruta.length > 0) {

            const map = L.map('map').setView([ruta[0].lat, ruta[0].lng], 13);

            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                subdomains: 'abcd',
                maxZoom: 19,
                attribution:
                    '&copy; OpenStreetMap &copy; CARTO'
            }).addTo(map);

            const coords = ruta.map(p => [p.lat, p.lng]);
            const polyline = L.polyline(coords, {
                color: "#3c0000",
                weight: 5,
                opacity: 0.8
            }).addTo(map);

            map.fitBounds(polyline.getBounds());

            ruta.forEach((p, i) => {
                L.marker([p.lat, p.lng])
                .addTo(map)
                .bindPopup(`<b>${i === 0 ? "Inicio:" : i === ruta.length - 1 ? "Fin:" : ""}</b> ${p.name}`);
            });
        }
    </script>

{% else %}
    <div class="route-container" style="background:#f7a098;">
        <h2>No se encontró ruta entre {{ origen }} y {{ destino }}.</h2>
        <p>Revisa horarios o conexiones disponibles.</p>
    </div>
{% endif %}
</main>

<footer>
<p>© 2025 Metro CDMX - Todos los derechos reservados</p>
</footer>

</body>
</html>
